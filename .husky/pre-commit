#!/usr/bin/env bash

run_step() {
  local name="$1"
  local cmd="$2"
  printf "%s... " "$name"
  local start=$(date +%s.%N)
  if output=$(eval "$cmd" 2>&1); then
    local end=$(date +%s.%N)
    local duration=$(echo "$end - $start" | bc)
    printf "✓ %.1fs\n" "$duration"
  else
    echo "✗"
    echo "$output" | tail -20
    exit 1
  fi
}

run_step "Build" "npm run build"
run_step "Tests" "npm test"
run_step "Remote tests" "npm run test:remote"
